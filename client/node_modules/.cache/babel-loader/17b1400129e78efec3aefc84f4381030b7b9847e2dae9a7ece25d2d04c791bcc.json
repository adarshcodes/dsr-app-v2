{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.resolveHref = resolveHref;\nvar _querystring = require(\"./querystring\");\nvar _formatUrl = require(\"./format-url\");\nvar _omit = require(\"./omit\");\nvar _utils = require(\"../../utils\");\nvar _normalizeTrailingSlash = require(\"../../../../client/normalize-trailing-slash\");\nvar _isLocalUrl = require(\"./is-local-url\");\nvar _isDynamic = require(\"./is-dynamic\");\nvar _interpolateAs = require(\"./interpolate-as\");\nfunction resolveHref(router, href, resolveAs) {\n  // we use a dummy base url for relative urls\n  let base;\n  let urlAsString = typeof href === 'string' ? href : (0, _formatUrl).formatWithValidation(href);\n  // repeated slashes and backslashes in the URL are considered\n  // invalid and will never match a Next.js page/file\n  const urlProtoMatch = urlAsString.match(/^[a-zA-Z]{1,}:\\/\\//);\n  const urlAsStringNoProto = urlProtoMatch ? urlAsString.slice(urlProtoMatch[0].length) : urlAsString;\n  const urlParts = urlAsStringNoProto.split('?');\n  if ((urlParts[0] || '').match(/(\\/\\/|\\\\)/)) {\n    console.error(`Invalid href '${urlAsString}' passed to next/router in page: '${router.pathname}'. Repeated forward-slashes (//) or backslashes \\\\ are not valid in the href.`);\n    const normalizedUrl = (0, _utils).normalizeRepeatedSlashes(urlAsStringNoProto);\n    urlAsString = (urlProtoMatch ? urlProtoMatch[0] : '') + normalizedUrl;\n  }\n  // Return because it cannot be routed by the Next.js router\n  if (!(0, _isLocalUrl).isLocalURL(urlAsString)) {\n    return resolveAs ? [urlAsString] : urlAsString;\n  }\n  try {\n    base = new URL(urlAsString.startsWith('#') ? router.asPath : router.pathname, 'http://n');\n  } catch (_) {\n    // fallback to / for invalid asPath values e.g. //\n    base = new URL('/', 'http://n');\n  }\n  try {\n    const finalUrl = new URL(urlAsString, base);\n    finalUrl.pathname = (0, _normalizeTrailingSlash).normalizePathTrailingSlash(finalUrl.pathname);\n    let interpolatedAs = '';\n    if ((0, _isDynamic).isDynamicRoute(finalUrl.pathname) && finalUrl.searchParams && resolveAs) {\n      const query = (0, _querystring).searchParamsToUrlQuery(finalUrl.searchParams);\n      const {\n        result,\n        params\n      } = (0, _interpolateAs).interpolateAs(finalUrl.pathname, finalUrl.pathname, query);\n      if (result) {\n        interpolatedAs = (0, _formatUrl).formatWithValidation({\n          pathname: result,\n          hash: finalUrl.hash,\n          query: (0, _omit).omit(query, params)\n        });\n      }\n    }\n    // if the origin didn't change, it means we received a relative href\n    const resolvedHref = finalUrl.origin === base.origin ? finalUrl.href.slice(finalUrl.origin.length) : finalUrl.href;\n    return resolveAs ? [resolvedHref, interpolatedAs || resolvedHref] : resolvedHref;\n  } catch (_1) {\n    return resolveAs ? [urlAsString] : urlAsString;\n  }\n}","map":{"version":3,"names":["resolveHref","_querystring","require","_formatUrl","_omit","_utils","_normalizeTrailingSlash","_isLocalUrl","_isDynamic","_interpolateAs","router","href","resolveAs","base","urlAsString","formatWithValidation","urlProtoMatch","match","urlAsStringNoProto","slice","length","urlParts","split","console","error","pathname","normalizedUrl","normalizeRepeatedSlashes","isLocalURL","URL","startsWith","asPath","_","finalUrl","normalizePathTrailingSlash","interpolatedAs","isDynamicRoute","searchParams","query","searchParamsToUrlQuery","result","params","interpolateAs","hash","omit","resolvedHref","origin","_1"],"sources":["../../../../../src/shared/lib/router/utils/resolve-href.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}